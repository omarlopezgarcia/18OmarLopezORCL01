/*CREAR TABLA PERSONA*/
CREATE TABLE persona
(
   IDPER INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1,
   DNIPER CHAR(8),
   NOMPER VARCHAR2(60),
   APEPER VARCHAR2(80),
   EMAPER VARCHAR2(80),
   CELPER CHAR(9),
   TIPPER CHAR(1),
   ESTPER CHAR(1) DEFAULT 'A',
   FECNACPER DATE,
   CONSTRAINT PER_PK PRIMARY KEY (IDPER)
);
COMMIT;

/*CREAR TABLA VENTA*/
CREATE TABLE venta
(
   IDVEN INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1,
   FECVEN DATE,
   IDVEND INT,
   IDCLI INT,
   TIPPAGVEN CHAR(1),
   ESTVEN CHAR(1) DEFAULT 'A',
   CONSTRAINT VEN_PK PRIMARY KEY (IDVEN)
);
COMMIT;

/*CREAR TABLA VENTA_DETALLE*/
CREATE TABLE venta_detalle
(
   IDVENDET INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1,
   IDVEND INT,
   CODPROD CHAR(3),
   CANVENDET INT,
   CONSTRAINT VENDET_PK PRIMARY KEY (IDVENDET)
);
COMMIT;

/*CREAR TABLA PRODUCTO*/
CREATE TABLE producto
(
   CODPROD INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1,
   NOMPRO VARCHAR2(50),
   IDCAT INT,
   PREPRO NUMBER(8,2),
   STOCKPRO INT,
   ESTPRO CHAR(1),
   CONSTRAINT PROD_PK PRIMARY KEY (CODPROD)
);
COMMIT;

/*CREAR TABLA CATEGORIA*/
CREATE TABLE categoria
(
   IDCAT INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1,
   NOMCAT VARCHAR2(60),
   CONSTRAINT CAT_PK PRIMARY KEY (IDCAT)
);
COMMIT;


/*LISTAR TABLAS DISPONIBLES*/
SELECT table_name
FROM all_tables
WHERE table_name IN ('PERSONA', 'VENTA', 'VENTA_DETALLE', 'PRODUCTO', 'CATEGORIA');


/*RELACIONES DE LAS TABLAS*/
/*PARA TABLA PERSONA*/
ALTER TABLE venta
    ADD CONSTRAINT FK_VENTA_VENDEDOR
    FOREIGN KEY (IDVEND)
    REFERENCES persona(IDPER);
COMMIT;
ALTER TABLE venta
    ADD CONSTRAINT FK_VENTA_CLIENTE
    FOREIGN KEY (IDCLI)
    REFERENCES persona(IDPER);
COMMIT;

/*PARA TABLA VENTA_DETALLE*/
ALTER TABLE venta
    ADD CONSTRAINT FK_VENTA
    FOREIGN KEY (IDVEND)
    REFERENCES venta_detalle(IDVEND);
COMMIT;

/*PARA TABLA VENTA*/
ALTER TABLE venta_detalle
    ADD CONSTRAINT FK_VENTA_DETALLE_VENTA
    FOREIGN KEY (IDVEND)
    REFERENCES venta(IDVEN);
COMMIT;

/*PARA TABLA PRODUCTO*/
ALTER TABLE categoria
ADD CONSTRAINT FK_CATEGORIA
FOREIGN KEY (IDCAT)
REFERENCES producto(IDCAT);


/*LISTAR RELACIONES TABLA VENTA*/
SELECT 
    c.constraint_name,
    c.table_name,
    cc.column_name,
    c.r_constraint_name,
    cc.position,
    rc.table_name AS referenced_table,
    rcc.column_name AS referenced_column
FROM 
    user_constraints c
JOIN 
    user_cons_columns cc ON c.constraint_name = cc.constraint_name
JOIN 
    user_constraints rc ON c.r_constraint_name = rc.constraint_name
JOIN 
    user_cons_columns rcc ON rc.constraint_name = rcc.constraint_name AND cc.position = rcc.position
WHERE 
    c.constraint_type = 'R'
    AND c.table_name IN ('PERSONA', 'VENTA', 'VENTA_DETALLE', 'PRODUCTO', 'CATEGORIA');
